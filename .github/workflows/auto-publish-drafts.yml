name: Auto-Publish from Drafts

on:
  push:
    paths:
      - 'drafts/*.html'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  move-to-posts:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Create posts directory
        run: mkdir -p posts
      
      - name: Move drafts to posts
        run: |
          if [ -d "drafts" ] && [ "$(ls -A drafts/*.html 2>/dev/null)" ]; then
            for file in drafts/*.html; do
              filename=$(basename "$file")
              echo "ğŸ“„ Moving $filename to posts/"
              mv "$file" "posts/$filename"
            done
          else
            echo "â„¹ï¸ No draft files to process"
          fi
      
      - name: Commit and push
        run: |
          git config user.name "Blog Auto-Publisher"
          git config user.email "bot@protecpremiumgranite.com"
          
          if [ -n "$(git status --porcelain)" ]; then
            git add posts/
            git add drafts/
            git commit -m "ğŸš€ Auto-publish: Move drafts to posts"
            git push
            
            echo "âœ… Posts published successfully!"
          else
            echo "â„¹ï¸ No changes to commit"
          fi
